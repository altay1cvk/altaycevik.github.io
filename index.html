<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Portfolio Altay CEVIK - Assistant IA (Style EHOSP)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script> <!-- Si vous l'utilisez toujours pour le fond -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="manifest" href="manifest.json"> <!-- Assurez-vous que ce fichier existe -->
    <meta name="theme-color" content="#f7f9fc"> <!-- Couleur de fond claire par défaut pour correspondre à EHOSP light -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="icons/icon-192x192.png">

    <style>
        /* --- VARIABLES CSS INSPIRÉES D'EHOSP (Mode Clair par défaut) --- */
        :root {
            --primary-color: #007AFF; /* Bleu EHOSP */
            --primary-hover-color: #0056b3;
            --primary-color-rgb: 0, 122, 255;

            --app-bg: #f7f9fc; /* Fond clair EHOSP */
            --header-chat-bg: rgba(255, 255, 255, 0.90);
            --chat-input-area-bg: #f0f4f9;

            --chat-bubble-ai-bg: #ffffff;
            --chat-bubble-ai-text: #1c1c1e;
            --chat-bubble-user-bg: var(--primary-color); /* Utilisateur (simulé) */
            --chat-bubble-user-text: #ffffff;

            --text-color: #1c1c1e;
            --secondary-text-color: #636366;
            --border-color: #d1d1d6;

            --button-action-bg: #eef0f2; /* Boutons d'options */
            --button-action-hover-bg: #dfe3e6;
            --button-action-text: var(--text-color);

            --radius-xl: 18px; --radius-lg: 14px; --radius-md: 10px; --radius-sm: 6px; --radius-pill: 30px;
            --shadow-soft: 0 1px 3px 0 rgba(0, 0, 0, 0.07);
            --shadow-medium: 0 3px 8px 0 rgba(0, 0, 0, 0.09);
            --transition-normal: 0.25s cubic-bezier(.4,0,.2,1);

            /* Variables de votre portfolio original si encore utilisées ailleurs */
            --altay-primary: #64ffda; 
            --altay-bg: #0a0a0a;
            --altay-text: #fff;
            --altay-card-bg: rgba(255, 255, 255, 0.1);
            --altay-font-mono: 'Courier New', Courier, monospace;
        }

        body.dark-mode {
            --primary-color: #0A84FF;
            --primary-hover-color: #3593ff;
            --primary-color-rgb: 10, 132, 255;
            --app-bg: #000000;
            --header-chat-bg: rgba(28, 28, 30, 0.92);
            --chat-input-area-bg: #161618;
            --chat-bubble-ai-bg: #2c2c2e;
            --chat-bubble-ai-text: #f2f2f7;
            --text-color: #f2f2f7;
            --secondary-text-color: #8e8e93;
            --border-color: #38383a;
            --button-action-bg: #2c2c2e;
            --button-action-hover-bg: #3a3a3c;
            --button-action-text: var(--text-color);
        }

        /* --- STYLES DE BASE & LOADER --- */
        html, body {
            height: 100%; margin: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: var(--app-bg); /* Fond général inspiré d'EHOSP */
            color: var(--text-color);
            overflow-x: hidden; /* Empêche le scroll horizontal global */
            font-size: 15.5px;
            -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        a { color: var(--primary-color); text-decoration: none; }
        a:hover { text-decoration: underline; }

        #loader-container { position: fixed; inset: 0; background-color: var(--app-bg); display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 1000; transition: opacity 0.5s ease, visibility 0.5s ease; }
        #loader-container.hidden { opacity: 0; visibility: hidden; }
        #loader-message { font-size: 1.5rem; color: var(--primary-color); margin-bottom: 2rem; text-align: center; font-weight: 600; }
        .progress-bar-loader { width: clamp(250px, 80%, 300px); height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--primary-color); width: 0%; transition: width 0.05s linear; }
        
        /* Canvas Three.js (si vous le gardez pour le fond DES SECTIONS, pas du chat) */
        #canvas-container { position: fixed; inset: 0; z-index: -2; /* Derrière tout */ opacity: 0.3; /* Plus subtil */ }

        /* --- STRUCTURE EHOSP CHAT --- */
        .ehosp-chat-app-container { /* Le conteneur principal pour le chat */
            display: flex; flex-direction: column;
            height: 100vh; /* Prend toute la hauteur */
            max-width: 700px; /* Largeur max comme sur ehosp.app */
            margin: 0 auto; /* Centré */
            background: var(--app-bg);
            box-shadow: var(--shadow-strong);
            position: relative;
            border-radius: var(--radius-xl); /* Coins arrondis si ce n'est pas en plein écran */
            overflow: hidden; /* Pour les coins arrondis */
            /* Sera affiché par JS */
            opacity: 0; transition: opacity 0.5s ease-in-out;
        }
        .ehosp-chat-app-container.visible { opacity: 1; }

        .ehosp-chat-header {
            background: var(--header-chat-bg);
            backdrop-filter: blur(10px);
            padding: 16px 18px;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0; z-index: 10;
            display: flex; justify-content: space-between; align-items: center;
        }
        .ehosp-chat-header h1 {
            font-size: 1.7rem; font-weight: 700; margin: 0;
            color: var(--primary-color);
            display: flex; align-items: center; gap: 8px;
        }
        .ehosp-chat-header h1 .fas.fa-robot { font-size: 1.5rem; }

        #ehosp-chat-messages { /* Zone des messages */
            flex-grow: 1;
            overflow-y: auto;
            padding: 18px 14px;
            display: flex; flex-direction: column; gap: 12px;
            scrollbar-width: thin; scrollbar-color: var(--border-color) transparent;
        }
        #ehosp-chat-messages::-webkit-scrollbar { width: 5px; }
        #ehosp-chat-messages::-webkit-scrollbar-track { background: transparent; }
        #ehosp-chat-messages::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: var(--radius-pill); }

        .ehosp-chat-message-wrapper {
            display: flex; margin-bottom: 5px; /* Moins d'espace que gap pour alignement avatar */
            max-width: 85%; opacity: 0; transform: translateY(10px);
            animation: ehospMessageAppear 0.4s ease-out forwards;
        }
        @keyframes ehospMessageAppear { to { opacity: 1; transform: translateY(0); } }

        .ehosp-chat-avatar {
            width: 36px; height: 36px; border-radius: 50%;
            background-color: var(--primary-color); color: #fff;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.1rem; margin-right: 10px; flex-shrink: 0;
            align-self: flex-end; /* Avatar en bas de la bulle */
        }
        .ehosp-chat-bubble {
            padding: 10px 14px; border-radius: var(--radius-lg);
            line-height: 1.5; font-size: 0.95rem;
            word-wrap: break-word;
        }
        /* Message de l'IA (robot) */
        .ehosp-ai-message .ehosp-chat-message-wrapper { align-self: flex-start; }
        .ehosp-ai-message .ehosp-chat-bubble {
            background: var(--chat-bubble-ai-bg); color: var(--chat-bubble-ai-text);
            border-bottom-left-radius: var(--radius-sm);
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-color);
        }
        /* Message de "l'utilisateur" (bouton cliqué) */
        .ehosp-user-simulated-message .ehosp-chat-message-wrapper { align-self: flex-end; flex-direction: row-reverse; }
        .ehosp-user-simulated-message .ehosp-chat-avatar { display: none; /* Pas d'avatar pour les "réponses" user */ }
        .ehosp-user-simulated-message .ehosp-chat-bubble {
            background: var(--chat-bubble-user-bg); color: var(--chat-bubble-user-text);
            border-bottom-right-radius: var(--radius-sm);
            margin-right: 0; /* Pas d'avatar à droite */
        }

        #ehosp-chat-options-area { /* Zone des boutons d'action */
            padding: 12px 14px;
            border-top: 1px solid var(--border-color);
            background-color: var(--chat-input-area-bg); /* Comme la zone de saisie d'EHOSP */
            flex-shrink: 0;
            display: flex; flex-wrap: wrap; justify-content: center; gap: 8px;
             opacity: 0; transition: opacity 0.3s ease-in-out 0.2s; /* Apparaît après le message */
        }
        #ehosp-chat-options-area.visible { opacity: 1; }

        .ehosp-chat-option-btn {
            background-color: var(--button-action-bg);
            color: var(--button-action-text);
            border: 1px solid var(--border-color);
            padding: 8px 15px;
            border-radius: var(--radius-pill);
            font-family: 'Inter', sans-serif; /* Police EHOSP */
            font-size: 0.88rem; font-weight: 500;
            cursor: pointer;
            transition: background-color var(--transition-normal), transform var(--transition-normal);
        }
        .ehosp-chat-option-btn:hover {
            background-color: var(--button-action-hover-bg);
            transform: translateY(-1px);
        }
        .ehosp-chat-option-btn i { margin-right: 6px; }

        .ehosp-chat-bubble .highlight { font-weight: 600; color: var(--primary-color); }
        .ehosp-chat-bubble a.chat-link { color: var(--primary-color); text-decoration: underline; font-weight: 500; }

        .typing-indicator-wrapper .ehosp-chat-avatar { margin-bottom: 0; /* Ajustement pour l'indicateur */ }
        .typing-indicator-bubble { /* (Votre style .typing-indicator-bubble) */ }

        /* --- VOS SECTIONS DE CONTENU ORIGINAL (skills, projects, etc.) --- */
        /* Elles seront affichées APRES que l'utilisateur ait interagi ou "quitté" le chat */
        .portfolio-content-sections {
            display: none; /* Caché initialement */
            padding: 3rem clamp(1rem, 5vw, 2rem); /* Votre padding original pour .content */
            max-width: 1300px; margin: 0 auto; /* Votre max-width original */
            font-family: var(--altay-font-mono); /* Police de votre portfolio original */
            background-color: var(--altay-bg); /* Fond de votre portfolio original */
            color: var(--altay-text);
        }
        /* Styles de vos sections originales (à copier depuis votre CSS) */
        .portfolio-content-sections .nav { /* ... styles de votre nav originale ... */ }
        .portfolio-content-sections .section { /* ... */ }
        .portfolio-content-sections .skills-container { /* ... */ }
        /* ... etc. ... */
        
        /* Styles pour le bouton Thème (si vous le gardez) */
        #theme-toggle {
            position: fixed; bottom: 20px; right: 20px;
            background-color: var(--button-action-bg); color: var(--primary-color);
            border: 1px solid var(--border-color); border-radius: 50%;
            width: 40px; height: 40px; font-size: 1.1rem; cursor: pointer; z-index: 1002;
            display: flex; justify-content: center; align-items: center;
            transition: all var(--transition-normal);
        }
        #theme-toggle:hover { transform: scale(1.1); }

        /* Responsive (très basique, à affiner) */
        @media (max-width: 700px) {
            .ehosp-chat-app-container { border-radius: 0; margin-top:0; margin-bottom:0; }
            .ehosp-chat-header h1 { font-size: 1.4rem; }
            .ehosp-chat-header h1 .fas.fa-robot { font-size: 1.3rem; }
            .ehosp-chat-bubble { font-size: 0.9rem; }
            .ehosp-chat-option-btn { font-size: 0.8rem; padding: 7px 12px;}
             /* Assurer que les sections du portfolio s'affichent bien sur mobile */
            .portfolio-content-sections { padding: 2rem 1rem; }
        }
    </style>
</head>
<body class="light-mode"> <!-- Commence en mode clair comme EHOSP -->

    <div id="loader-container">
        <p id="loader-message">Bonjour ! Mon assistant IA se prépare...</p>
        <div class="progress-bar-loader"><div class="progress-bar-fill"></div></div>
    </div>

    <!-- Le canvas Three.js peut être un fond subtil pour les sections du portfolio -->
    <div id="canvas-container"></div>

    <!-- Conteneur principal du Chat inspiré d'EHOSP -->
    <main class="ehosp-chat-app-container" id="ehosp-chat-main">
        <header class="ehosp-chat-header">
            <h1><i class="fas fa-robot"></i> Assistant d'Altay</h1>
            <!-- Bouton Thème peut être ici ou dans le portfolio-content-sections -->
            <button id="theme-toggle" aria-label="Changer de thème">
                <!-- Icône gérée par JS -->
            </button>
        </header>
        <div id="ehosp-chat-messages">
            <!-- Les messages du chatbot seront injectés ici -->
        </div>
        <div id="ehosp-chat-options-area">
            <!-- Les boutons d'options pour guider la conversation seront ici -->
        </div>
    </main>

    <!-- Vos sections de contenu originales, initialement masquées -->
    <div class="portfolio-content-sections" id="portfolio-sections">
        <nav class="nav"> <!-- Votre NAV originale -->
            <ul>
                <li><a href="#" id="back-to-chat-link">Retour à l'Assistant IA</a></li>
                <li><a href="#skills-original">Compétences</a></li>
                <li><a href="#projects-original">Projets</a></li>
                <li><a href="#cv-original">Parcours</a></li>
                <li><a href="https://drive.google.com/file/d/1iYN5GO-OhEW0ut0aBoPFM6CSA6omyRYw/view?usp=sharing" target="_blank" rel="noopener noreferrer">CV PDF</a></li>
                <li><a href="#contact-original">Contact</a></li>
            </ul>
        </nav>

        <header class="header" id="about-original" style="min-height: auto; padding: 3rem 0;"> <!-- Votre header original réduit -->
            <h1 class="title" style="font-family: var(--altay-font-mono); color:var(--altay-primary);">Altay CEVIK</h1>
            <p style="font-family: var(--altay-font-mono); color:var(--altay-text); max-width:700px; margin:1rem auto;">
                Développeur IA & IoT passionné, avec une solide base en développement full-stack et une curiosité insatiable pour les nouvelles technologies.
            </p>
        </header>

        <section class="section" id="skills-original">
            <h2 style="font-family: var(--altay-font-mono); color:var(--altay-primary);"><span class="emoji">🛠️</span> Compétences</h2>
            <!-- ... VOTRE CONTENU HTML ORIGINAL POUR LES COMPÉTENCES ... -->
        </section>

        <section class="section" id="projects-original">
             <h2 style="font-family: var(--altay-font-mono); color:var(--altay-primary);"><span class="emoji">📁</span> Mes Projets</h2>
            <!-- ... VOTRE CONTENU HTML ORIGINAL POUR LES PROJETS (Y COMPRIS EHOSP) ... -->
        </section>

        <section class="section" id="cv-original">
             <h2 style="font-family: var(--altay-font-mono); color:var(--altay-primary);"><span class="emoji">📄</span> Mon Parcours</h2>
            <!-- ... VOTRE CONTENU HTML ORIGINAL POUR LE PARCOURS/CV ... -->
        </section>

        <section class="section" id="contact-original">
            <h2 style="font-family: var(--altay-font-mono); color:var(--altay-primary);"><span class="emoji">✉️</span> Contactez-moi</h2>
            <!-- ... VOTRE FORMULAIRE DE CONTACT ORIGINAL ... -->
        </section>
    </div>


    <script defer>
        // --- DOM Elements ---
        const loaderContainer = document.getElementById('loader-container');
        const ehospChatMain = document.getElementById('ehosp-chat-main');
        const chatMessagesContainer = document.getElementById('ehosp-chat-messages');
        const chatOptionsArea = document.getElementById('ehosp-chat-options-area');
        
        const portfolioSectionsDiv = document.getElementById('portfolio-sections');
        const backToChatLink = document.getElementById('back-to-chat-link');

        const htmlEl = document.documentElement;
        const themeToggleBtn = document.getElementById('theme-toggle'); // Renommé pour clarté

        // --- Vos données de profil (à remplir) ---
        const userProfileData = {
            name: "Altay CEVIK",
            greeting: "Bonjour ! Je suis l'assistant virtuel d'<span class='highlight'>Altay</span>. Prêt à découvrir un développeur IA & IoT passionné ?",
            about: "Altay est un futur expert en <span class='highlight'>Intelligence Artificielle</span> et <span class='highlight'>Objets Connectés</span>. Actuellement en BUT R&T avec une spécialisation IoT, il se dirige vers un <span class='highlight'>Master IA</span> en alternance à la rentrée 2025. Curieux et proactif, il adore transformer des idées innovantes en solutions concrètes.",
            skillsIntro: "Altay a un éventail de compétences solide. Voici les principales :",
            skillsList: [
                "IA/ML: <span class='highlight'>TensorFlow, YOLOv8, PyTorch</span>",
                "Développement: <span class='highlight'>Python, JavaScript, Java, C#</span>",
                "Web & Outils: <span class='highlight'>Node.js, React, Docker, Git</span>",
                "IoT: <span class='highlight'>Raspberry Pi, MQTT</span>"
            ],
            projectsIntro: "Il a mené plusieurs projets significatifs :",
            projectsList: [
                { name: "EHOSP - Plateforme Santé", desc: "Contribution à une solution intégrant IA et IoT.", link: "https://www.ehosp.fr/", icon: "fas fa-heartbeat" },
                { name: "Supervision Data Center", desc: "Monitoring IoT avec TIG Stack.", github: "https://github.com/altay1cvk/Creation-Data-Center", icon: "fas fa-server" },
                { name: "IA Trading (Concept)", desc: "Exploration Python pour le trading automatisé.", icon: "fas fa-chart-line" }
            ],
            parcoursIntro: "Son parcours est axé sur la technologie et l'innovation :",
            parcoursList: [
                "Master IA (Prévu Sept. 2025, CNAM Mulhouse)",
                "BUT R&T - Spé. IoT (2022-2025, IUT Nord Franche-Comté)",
                "Stage IA - Drone (Prévu Fév. 2025, FEMTO-ST)"
            ],
            closing: "Merci de votre intérêt ! Vous pouvez explorer son portfolio complet ou le contacter."
        };

        // --- Fonctions du Loader ---
        function hideLoaderAndStartChat() {
            if (loaderContainer) loaderContainer.classList.add('hidden');
            if (ehospChatMain) ehospChatMain.classList.add('visible'); // Affiche le chat
            startEhospStyleChat();
        }
        if (loaderContainer) {
            let loadProgress = 0;
            const progressBarFill = document.querySelector('.progress-bar-fill');
            const loadInterval = setInterval(() => {
                loadProgress++;
                if (progressBarFill) progressBarFill.style.width = loadProgress + '%';
                if (loadProgress >= 100) { clearInterval(loadInterval); setTimeout(hideLoaderAndStartChat, 400); }
            }, 25);
        } else {
            hideLoaderAndStartChat();
        }

        // --- Logique du Chatbot Stylisé EHOSP ---
        let currentChatState = 'greeting';
        const typingIndicatorDelay = 700; // Délai avant d'afficher "..."

        async function addEhospBotMessage(htmlContent, options = []) {
            return new Promise(async (resolve) => {
                // 1. Afficher l'indicateur "..."
                const typingWrapper = document.createElement('div');
                typingWrapper.className = 'ehosp-chat-message-wrapper ehosp-ai-message typing-indicator-wrapper';
                typingWrapper.innerHTML = `
                    <div class="ehosp-chat-avatar"><i class="fas fa-robot"></i></div>
                    <div class="ehosp-chat-bubble typing-indicator-bubble"><span></span><span></span><span></span></div>
                `;
                chatMessagesContainer.appendChild(typingWrapper);
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;

                await new Promise(r => setTimeout(r, typingIndicatorDelay + Math.random() * 500)); // Simule la frappe

                // 2. Enlever l'indicateur et afficher le vrai message
                typingWrapper.remove();
                
                const messageWrapper = document.createElement('div');
                messageWrapper.className = 'ehosp-chat-message-wrapper ehosp-ai-message';
                
                const avatar = document.createElement('div');
                avatar.className = 'ehosp-chat-avatar';
                avatar.innerHTML = '<i class="fas fa-robot"></i>';
                messageWrapper.appendChild(avatar);

                const bubble = document.createElement('div');
                bubble.className = 'ehosp-chat-bubble';
                bubble.innerHTML = htmlContent; // Le HTML est directement inséré
                messageWrapper.appendChild(bubble);
                
                chatMessagesContainer.appendChild(messageWrapper);
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
                
                // Animer l'apparition du message (déjà géré par CSS avec @keyframes ehospMessageAppear)

                // 3. Afficher les options après un court délai
                setTimeout(() => {
                    displayEhospChatOptions(options);
                    resolve();
                }, 300); // Délai avant d'afficher les boutons
            });
        }

        function displayEhospChatOptions(optionsArray) {
            chatOptionsArea.innerHTML = '';
            if (!optionsArray || optionsArray.length === 0) {
                chatOptionsArea.classList.remove('visible');
                return;
            }
            optionsArray.forEach(opt => {
                const button = document.createElement('button');
                button.className = 'ehosp-chat-option-btn';
                button.innerHTML = opt.icon ? `<i class="${opt.icon}"></i> ${opt.text}` : opt.text;
                button.onclick = () => {
                    chatOptionsArea.classList.remove('visible'); // Cacher les options
                    // Simuler la "réponse" de l'utilisateur (optionnel, mais rend plus "chat")
                    // addSimulatedUserResponse(opt.text); 
                    setTimeout(opt.action, 150); // Action après un petit délai
                };
                chatOptionsArea.appendChild(button);
            });
            setTimeout(() => chatOptionsArea.classList.add('visible'), 50); // Rendre visible avec transition
        }

        // function addSimulatedUserResponse(text) { // Optionnel
        //     const messageWrapper = document.createElement('div');
        //     messageWrapper.className = 'ehosp-chat-message-wrapper ehosp-user-simulated-message';
        //     const bubble = document.createElement('div');
        //     bubble.className = 'ehosp-chat-bubble';
        //     bubble.textContent = text;
        //     messageWrapper.appendChild(bubble);
        //     chatMessagesContainer.appendChild(messageWrapper);
        //     chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
        // }

        // --- Définition des États et Actions du Chat ---
        const ehospChatStates = {
            greeting: {
                message: () => userProfileData.greeting,
                options: () => [
                    { text: "Oui, présente-le !", icon: "fas fa-play-circle", action: () => updateEhospChatState('introduction') },
                    { text: "Voir le portfolio direct", icon: "fas fa-folder-open", action: showFullPortfolioContent }
                ]
            },
            introduction: {
                message: () => userProfileData.about,
                options: () => [
                    { text: "Ses compétences ?", icon: "fas fa-cogs", action: () => updateEhospChatState('skills') },
                    { text: "Ses projets ?", icon: "fas fa-project-diagram", action: () => updateEhospChatState('projects') },
                    { text: "Son parcours ?", icon: "fas fa-graduation-cap", action: () => updateEhospChatState('parcours') },
                    { text: "Voir tout le portfolio", icon: "fas fa-folder-open", action: showFullPortfolioContent }
                ]
            },
            skills: {
                message: () => {
                    let msg = `${userProfileData.skillsIntro}<ul style="list-style:none; padding:10px 0 0 5px; text-align:left;">`;
                    userProfileData.skillsList.forEach(s => msg += `<li style="margin-bottom:5px;">✅ ${s}</li>`);
                    msg += `</ul><br>Plus de détails sur <a href="#skills-original" class="chat-link" onclick="showFullPortfolioContentAndScroll('skills-original')">sa page Compétences</a>. Que voir ensuite ?`;
                    return msg;
                },
                options: () => ehospChatStates.introduction.options().filter(o => !o.action.toString().includes("skills"))
            },
            projects: {
                message: () => {
                    let msg = `${userProfileData.projectsIntro}<ul style="list-style:none; padding:10px 0 0 5px; text-align:left;">`;
                    userProfileData.projectsList.forEach(p => {
                        msg += `<li style="margin-bottom:8px;"><i class="${p.icon || 'fas fa-lightbulb'}" style="color:var(--primary-color); margin-right:5px;"></i><span class="highlight">${p.name}:</span> ${p.desc} `;
                        if (p.link) msg += `<a href="${p.link}" target="_blank" class="chat-link">Visiter <i class="fas fa-external-link-alt fa-xs"></i></a>`;
                        if (p.github) msg += `<a href="${p.github}" target="_blank" class="chat-link">GitHub <i class="fab fa-github fa-xs"></i></a>`;
                        msg += `</li>`;
                    });
                    msg += `</ul><br>Tous ses projets sont sur <a href="#projects-original" class="chat-link" onclick="showFullPortfolioContentAndScroll('projects-original')">sa page Projets</a>. Et après ?`;
                    return msg;
                },
                options: () => ehospChatStates.introduction.options().filter(o => !o.action.toString().includes("projects"))
            },
            parcours: {
                message: () => {
                    let msg = `${userProfileData.parcoursIntro}<ul style="list-style:none; padding:10px 0 0 5px; text-align:left;">`;
                    userProfileData.parcoursList.forEach(p => msg += `<li style="margin-bottom:5px;"><i class="fas fa-map-marker-alt" style="color:var(--primary-color); margin-right:5px;"></i>${p.item}</li>`);
                    msg += `</ul><br>Son <a href="#cv-original" class="chat-link" onclick="showFullPortfolioContentAndScroll('cv-original')">parcours complet est ici</a>. Une dernière chose ?`;
                    return msg;
                },
                options: () => ehospChatStates.introduction.options().filter(o => !o.action.toString().includes("parcours"))
            },
            end: {
                message: () => userProfileData.closing,
                options: () => [
                     { text: "Contacter Altay", icon: "fas fa-envelope", action: () => showFullPortfolioContentAndScroll('contact-original') },
                     { text: "Revoir la présentation", icon: "fas fa-redo", action: () => { chatMessagesContainer.innerHTML=''; updateEhospChatState('greeting');} },
                ]
            }
        };

        async function updateEhospChatState(newState) {
            currentChatState = newState;
            const state = ehospChatStates[currentChatState];
            if (state) {
                await addEhospBotMessage(state.message(), state.options());
            }
        }
        
        function showFullPortfolioContent() {
            if (ehospChatMain) ehospChatMain.style.display = 'none'; // Cache le chat
            if (portfolioSectionsDiv) portfolioSectionsDiv.style.display = 'block'; // Affiche le contenu du portfolio
            if (document.querySelector('.nav')) document.querySelector('.nav').style.display = 'block'; // Afficher la nav principale de votre portfolio
            // Activer les observers pour les animations de section de votre portfolio original
            // if (intersectionObserver) { /* ... (votre logique d'observer les sections) ... */ }
        }
        
        window.showFullPortfolioContentAndScroll = function(sectionId) { // Rendre globale pour onclick
            showFullPortfolioContent();
            setTimeout(() => { // Délai pour s'assurer que la section est visible
                 const element = document.getElementById(sectionId);
                 if (element) element.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        if (backToChatLink) {
            backToChatLink.addEventListener('click', (e) => {
                e.preventDefault();
                if (portfolioSectionsDiv) portfolioSectionsDiv.style.display = 'none';
                if (ehospChatMain) ehospChatMain.style.display = 'flex'; // Réafficher le chat
                if (document.querySelector('.nav')) document.querySelector('.nav').style.display = 'none'; // Cacher la nav du portfolio
                updateEhospChatState('greeting'); // Recommencer ou reprendre
            });
        }


        function startEhospStyleChat() {
            updateEhospChatState('greeting');
        }

        // --- GESTION THÈME & THREE.JS (Votre code original adapté) ---
        let isDarkMode = document.body.classList.contains('dark-mode'); // Ou localStorage
        function applyTheme(theme) {
            isDarkMode = (theme === 'dark');
            htmlEl.classList.toggle('dark-mode', isDarkMode);
            document.body.classList.toggle('dark-mode', isDarkMode); // Appliquer aussi au body pour le fond global
             if(themeToggleBtn) themeToggleBtn.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
            // const themeColorMeta = document.querySelector('meta[name="theme-color"]');
            // if (themeColorMeta) themeColorMeta.content = getComputedStyle(htmlEl).getPropertyValue('--app-bg').trim();
            
            // Mise à jour couleur particules Three.js si particlesMaterial est défini
            // if (typeof particlesMaterial !== 'undefined' && particlesMaterial) {
            //     particlesMaterial.color.set(getComputedStyle(htmlEl).getPropertyValue(isDarkMode ? '--altay-particle-dark' : '--altay-particle-light').trim());
            // }
        }
        if (themeToggleBtn) {
            themeToggleBtn.addEventListener('click', () => {
                applyTheme(htmlEl.classList.contains('dark-mode') ? 'light' : 'dark');
                // localStorage.setItem('theme', htmlEl.classList.contains('dark-mode') ? 'dark' : 'light');
            });
        }
        // Préférence initiale (simplifié, adaptez à votre logique localStorage)
        // const storedTheme = localStorage.getItem('theme');
        // applyTheme(storedTheme || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'));
        applyTheme('light'); // Force le mode clair au début comme EHOSP

        // Three.js (votre code, attention aux variables de couleur des particules)
        // const scene = new THREE.Scene(); /* ... etc. ... */

        // ... (Votre code JS original restant : IntersectionObserver, gestion des dossiers projets, formulaire, SW...)
        // Assurez-vous qu'il ne rentre pas en conflit et qu'il s'applique bien à #portfolio-sections

    </script>
</body>
</html>
